variant: openshift
version: 4.20.0
metadata:
  labels:
    machineconfiguration.openshift.io/role: worker
  name: 99-worker-crio-credential-provider-config
storage:
  files:
    - path: /etc/kubernetes/credential-providers/ecr-credential-provider.yaml
      mode: 0644
      overwrite: true
      contents:
        inline: |
          apiVersion: kubelet.config.k8s.io/v1
          kind: CredentialProviderConfig
          providers:
            - name: ecr-credential-provider
              matchImages:
                - "*.dkr.ecr.*.amazonaws.com"
                - "*.dkr.ecr.*.amazonaws.com.cn"
                - "*.dkr.ecr-fips.*.amazonaws.com"
                - "*.dkr.ecr.us-iso-east-1.c2s.ic.gov"
                - "*.dkr.ecr.us-isob-east-1.sc2s.sgov.gov"
              defaultCacheDuration: "12h"
              apiVersion: credentialprovider.kubelet.k8s.io/v1
            - name: crio-credential-provider
              matchImages:
                - docker.io
              defaultCacheDuration: "1s"
              apiVersion: credentialprovider.kubelet.k8s.io/v1
              tokenAttributes:
                serviceAccountTokenAudience: https://kubernetes.default.svc
                cacheType: Token
                requireServiceAccount: false
    - path: /etc/containers/registries.conf
      mode: 0644
      overwrite: true
      contents:
        inline: |
          unqualified-search-registries = ["docker.io", "registry.access.redhat.com"]

          [[registry]]
          location = "docker.io"

          [[registry.mirror]]
          location = "localhost:5000"
          insecure = true
